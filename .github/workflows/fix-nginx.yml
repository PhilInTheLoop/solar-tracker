name: Fix Nginx Config

on:
  workflow_dispatch:

jobs:
  fix:
    runs-on: ubuntu-latest
    steps:
      - name: Remove IP from fxmonitor and set solar-tracker as default
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          script: |
            sed -i 's/ 87\.106\.30\.14//g' /etc/nginx/sites-available/fxmonitor
            echo "=== fxmonitor after fix ==="
            grep server_name /etc/nginx/sites-available/fxmonitor
            nginx -t && systemctl reload nginx
            echo "Done - IP removed from fxmonitor, solar-tracker is default_server"
